package ItemCheckout;

import java.sql.*;
import java.util.*;

/*
 * create table
 * insert
 * getbydate
 * get by student id
 * get by item id
 * getlastperson by item
 * delete
 */
public class SQLCheckoutItemRepo {
  
  SQLCheckoutItemRepo() throws SQLException {
    create();
  }
  
//  public List<InventoryItem> getAll() throws SQLException {
//    String query = "select * from inventory";
//    ResultSet rs= connect().prepareStatement(query).executeQuery();
//    return makeInventoryList(rs);
//  }
//
//  public List<InventoryItem> getByCurrentState(String state) throws SQLException {
//    String query = "select * from inventory where inventory.current_state = ?";
//    PreparedStatement stmt = connect().prepareStatement(query);
//    stmt.setString(1, state);
//    ResultSet rs = stmt.executeQuery();
//    return makeInventoryList(rs);
//  }
//
//  public InventoryItem getItemById(String id) throws SQLException, ItemException {
//    String query = "select * from inventory where inventory.id = ?";
//    PreparedStatement stmt = connect().prepareStatement(query);
//    stmt.setString(1, id);
//    ResultSet rs = stmt.executeQuery();
//    if (rs.next()) return toItem(rs);
//    else throw new ItemException("item id doesnt' exist");
//  }
//
//  public void insertNewItem(InventoryItem item) throws SQLException, ItemException {
//    Connection dbCon = connect();
//    String query = "select id from inventory where inventory.id = ?";
//    PreparedStatement stmt = dbCon.prepareStatement(query);
//    stmt.setString(1,item.getId());
//    if (!stmt.executeQuery().next()) {
//      query = "insert into inventory values(?,?,?,?)";
//      stmt = dbCon.prepareStatement(query);
//      stmt.setString(1,item.getId());
//      stmt.setString(2,item.getDiscription());
//      stmt.setString(3,item.getState());
//      stmt.setString(4,item.getReminder());
//      stmt.executeUpdate();
//    }
//    else throw new ItemException("item id already exists");
//  }
//
//  public void updateState(String id, String state) throws SQLException {
//    if (state == "delete") deleteItem(id);
//    else {
//      String query = "update inventory set current_state= ? where id= ?";
//      PreparedStatement stmt = connect().prepareStatement(query);
//      stmt.setString(1, state);
//      stmt.setString(2, id);
//      stmt.executeUpdate();   
//    }
//  }
//  
//  private void deleteItem(String id) throws SQLException {
//    String query = "delete from inventory where id = ?";
//    PreparedStatement stmt = connect().prepareStatement(query);
//    stmt.setString(1, id);
//    stmt.executeUpdate();
//  }
//  
  private Connection connect() throws SQLException{
    String dbURL = "jdbc:mysql://localhost/inventory";
    String username ="root";
    String password = "password";
    return DriverManager.getConnection(dbURL, username, password);
  }
//  
//  private List<InventoryItem> makeInventoryList(ResultSet rs) throws SQLException {
//    List<InventoryItem> items = new ArrayList<InventoryItem>();   
//    while (rs.next()) items.add(toItem(rs));
//    return items;
//  }
//  
//  private InventoryItem toItem(ResultSet rs) throws SQLException {
//    return new InventoryItem(rs.getString("id"), rs.getString("item"), rs.getString("current_state"), rs.getString("reminder_message"));
//  }
//  
  private void create() throws SQLException {
    Connection dbCon = connect();
    String table = "create table checkout(" +
        "studentId varchar(20) not null," +
        "studentEmail varchar(50) not null," +
        "employeeId varchar(50) not null," +
        "itemId varchar(20) not null," +
        "time TIMESTAMP DEFAULT CURRENT_TIMESTAMP," +
        "dueDate TIMESTAMP not null)";
    if (!dbCon.getMetaData().getTables(null, null, "inventory", null).next()) 
      dbCon.createStatement().executeUpdate(table);
  }
}
